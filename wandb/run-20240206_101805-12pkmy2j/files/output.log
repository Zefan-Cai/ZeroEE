02/06/2024 10:18:08 - INFO - __main__ - ***** Running training *****
02/06/2024 10:18:08 - INFO - __main__ -   Num examples = 163352
02/06/2024 10:18:08 - INFO - __main__ -   Num Epochs = 20
02/06/2024 10:18:08 - INFO - __main__ -   Instantaneous batch size per device = 16
02/06/2024 10:18:08 - INFO - __main__ -   Total train batch size (w. parallel, distributed & accumulation) = 96
02/06/2024 10:18:08 - INFO - __main__ -   Gradient Accumulation steps = 1
02/06/2024 10:18:08 - INFO - __main__ -   Total optimization steps = 34040
  0%|                                                                                                    | 1/34040 [00:06<61:23:00,  6.49s/it]02/06/2024 10:18:14 - INFO - __main__ -   Step: 1, LR: 1.9588638589618025e-08, Loss: 6.785383224487305
02/06/2024 10:18:14 - INFO - __main__ - args.eval_steps is None. Set to do eval after each epoch, which is 1702
  0%|                                                                                                    | 2/34040 [00:12<59:44:32,  6.32s/it]02/06/2024 10:18:21 - INFO - __main__ -   Step: 2, LR: 3.917727717923605e-08, Loss: 6.487704277038574
  0%|                                                                                                    | 3/34040 [00:16<49:57:56,  5.28s/it]02/06/2024 10:18:25 - INFO - __main__ -   Step: 3, LR: 5.8765915768854064e-08, Loss: 6.381295680999756
  0%|                                                                                                    | 4/34040 [00:20<44:32:14,  4.71s/it]02/06/2024 10:18:28 - INFO - __main__ -   Step: 4, LR: 7.83545543584721e-08, Loss: 6.365420341491699
  0%|                                                                                                    | 5/34040 [00:24<41:28:36,  4.39s/it]02/06/2024 10:18:32 - INFO - __main__ -   Step: 5, LR: 9.794319294809012e-08, Loss: 6.331789970397949
  0%|                                                                                                    | 6/34040 [00:28<39:40:40,  4.20s/it]02/06/2024 10:18:36 - INFO - __main__ -   Step: 6, LR: 1.1753183153770813e-07, Loss: 6.679637908935547
  0%|                                                                                                    | 7/34040 [00:32<38:32:09,  4.08s/it]02/06/2024 10:18:40 - INFO - __main__ -   Step: 7, LR: 1.3712047012732616e-07, Loss: 6.590797424316406
  0%|                                                                                                    | 8/34040 [00:35<37:43:02,  3.99s/it]02/06/2024 10:18:44 - INFO - __main__ -   Step: 8, LR: 1.567091087169442e-07, Loss: 6.918631553649902
  0%|                                                                                                    | 9/34040 [00:39<37:11:19,  3.93s/it]02/06/2024 10:18:48 - INFO - __main__ -   Step: 9, LR: 1.7629774730656223e-07, Loss: 6.684788703918457
  0%|                                                                                                   | 10/34040 [00:43<36:53:26,  3.90s/it]02/06/2024 10:18:51 - INFO - __main__ -   Step: 10, LR: 1.9588638589618024e-07, Loss: 6.272195339202881
  0%|                                                                                                   | 11/34040 [00:47<36:39:38,  3.88s/it]02/06/2024 10:18:55 - INFO - __main__ -   Step: 11, LR: 2.1547502448579825e-07, Loss: 6.299567699432373
  0%|                                                                                                   | 12/34040 [00:51<36:28:19,  3.86s/it]02/06/2024 10:18:59 - INFO - __main__ -   Step: 12, LR: 2.3506366307541625e-07, Loss: 6.530025482177734
  0%|                                                                                                   | 13/34040 [00:54<36:23:34,  3.85s/it]02/06/2024 10:19:03 - INFO - __main__ -   Step: 13, LR: 2.546523016650343e-07, Loss: 6.369572639465332
  0%|                                                                                                   | 14/34040 [00:58<36:17:03,  3.84s/it]02/06/2024 10:19:07 - INFO - __main__ -   Step: 14, LR: 2.742409402546523e-07, Loss: 6.447582244873047
  0%|                                                                                                   | 15/34040 [01:02<36:13:03,  3.83s/it]02/06/2024 10:19:10 - INFO - __main__ -   Step: 15, LR: 2.9382957884427033e-07, Loss: 6.171655178070068
  0%|                                                                                                   | 16/34040 [01:06<36:10:27,  3.83s/it]02/06/2024 10:19:14 - INFO - __main__ -   Step: 16, LR: 3.134182174338884e-07, Loss: 6.128865718841553
  0%|                                                                                                   | 17/34040 [01:10<36:10:00,  3.83s/it]02/06/2024 10:19:18 - INFO - __main__ -   Step: 17, LR: 3.330068560235064e-07, Loss: 6.0425543785095215
  0%|                                                                                                   | 18/34040 [01:14<36:10:29,  3.83s/it]02/06/2024 10:19:22 - INFO - __main__ -   Step: 18, LR: 3.5259549461312446e-07, Loss: 5.899574279785156
  0%|                                                                                                   | 19/34040 [01:18<39:05:25,  4.14s/it]02/06/2024 10:19:27 - INFO - __main__ -   Step: 19, LR: 3.7218413320274247e-07, Loss: 5.91293478012085
  0%|                                                                                                   | 20/34040 [01:22<38:10:11,  4.04s/it]02/06/2024 10:19:31 - INFO - __main__ -   Step: 20, LR: 3.917727717923605e-07, Loss: 6.245959758758545
  0%|                                                                                                   | 21/34040 [01:26<37:31:07,  3.97s/it]02/06/2024 10:19:34 - INFO - __main__ -   Step: 21, LR: 4.1136141038197843e-07, Loss: 6.155506134033203
  0%|                                                                                                   | 22/34040 [01:30<37:06:47,  3.93s/it]02/06/2024 10:19:38 - INFO - __main__ -   Step: 22, LR: 4.309500489715965e-07, Loss: 5.110983848571777
  0%|                                                                                                   | 23/34040 [01:34<36:48:16,  3.90s/it]02/06/2024 10:19:42 - INFO - __main__ -   Step: 23, LR: 4.505386875612145e-07, Loss: 5.279531002044678
  0%|                                                                                                   | 24/34040 [01:38<36:36:11,  3.87s/it]02/06/2024 10:19:46 - INFO - __main__ -   Step: 24, LR: 4.701273261508325e-07, Loss: 5.084543228149414
  0%|                                                                                                   | 25/34040 [01:41<36:25:58,  3.86s/it]02/06/2024 10:19:50 - INFO - __main__ -   Step: 25, LR: 4.897159647404505e-07, Loss: 5.101834774017334
  0%|                                                                                                   | 26/34040 [01:45<36:19:48,  3.85s/it]02/06/2024 10:19:54 - INFO - __main__ -   Step: 26, LR: 5.093046033300686e-07, Loss: 4.887321472167969
  0%|                                                                                                   | 27/34040 [01:49<36:52:50,  3.90s/it]02/06/2024 10:19:58 - INFO - __main__ -   Step: 27, LR: 5.288932419196866e-07, Loss: 4.938688278198242
  0%|                                                                                                   | 28/34040 [01:53<36:37:46,  3.88s/it]02/06/2024 10:20:01 - INFO - __main__ -   Step: 28, LR: 5.484818805093046e-07, Loss: 5.085078239440918
  0%|                                                                                                   | 29/34040 [01:57<36:29:42,  3.86s/it]02/06/2024 10:20:05 - INFO - __main__ -   Step: 29, LR: 5.680705190989227e-07, Loss: 3.9235386848449707
  0%|                                                                                                   | 30/34040 [02:01<36:22:34,  3.85s/it]02/06/2024 10:20:09 - INFO - __main__ -   Step: 30, LR: 5.876591576885407e-07, Loss: 3.0826964378356934
  0%|                                                                                                   | 31/34040 [02:04<36:16:06,  3.84s/it]02/06/2024 10:20:13 - INFO - __main__ -   Step: 31, LR: 6.072477962781588e-07, Loss: 2.9720444679260254
  0%|                                                                                                   | 32/34040 [02:08<36:19:46,  3.85s/it]02/06/2024 10:20:17 - INFO - __main__ -   Step: 32, LR: 6.268364348677768e-07, Loss: 2.5894899368286133
  0%|                                                                                                   | 33/34040 [02:12<36:12:54,  3.83s/it]02/06/2024 10:20:21 - INFO - __main__ -   Step: 33, LR: 6.464250734573947e-07, Loss: 2.4944536685943604
  0%|                                                                                                   | 34/34040 [02:16<36:10:29,  3.83s/it]02/06/2024 10:20:24 - INFO - __main__ -   Step: 34, LR: 6.660137120470128e-07, Loss: 2.2475500106811523
  0%|                                                                                                   | 35/34040 [02:20<36:06:33,  3.82s/it]02/06/2024 10:20:28 - INFO - __main__ -   Step: 35, LR: 6.856023506366308e-07, Loss: 1.9083904027938843
  0%|                                                                                                   | 36/34040 [02:24<36:05:08,  3.82s/it]02/06/2024 10:20:32 - INFO - __main__ -   Step: 36, LR: 7.051909892262489e-07, Loss: 1.6396901607513428
  0%|                                                                                                   | 37/34040 [02:27<36:17:03,  3.84s/it]02/06/2024 10:20:36 - INFO - __main__ -   Step: 37, LR: 7.247796278158668e-07, Loss: 1.4709804058074951
  0%|                                                                                                   | 38/34040 [02:31<36:12:33,  3.83s/it]02/06/2024 10:20:40 - INFO - __main__ -   Step: 38, LR: 7.443682664054849e-07, Loss: 1.1131069660186768
  0%|                                                                                                   | 39/34040 [02:35<36:12:00,  3.83s/it]02/06/2024 10:20:43 - INFO - __main__ -   Step: 39, LR: 7.639569049951028e-07, Loss: 0.577865481376648
  0%|                                                                                                   | 40/34040 [02:39<36:07:36,  3.83s/it]02/06/2024 10:20:47 - INFO - __main__ -   Step: 40, LR: 7.83545543584721e-07, Loss: 0.5169820189476013
  0%|                                                                                                   | 41/34040 [02:43<36:07:10,  3.82s/it]02/06/2024 10:20:51 - INFO - __main__ -   Step: 41, LR: 8.03134182174339e-07, Loss: 0.49384522438049316
  0%|                                                                                                   | 42/34040 [02:47<36:10:42,  3.83s/it]02/06/2024 10:20:55 - INFO - __main__ -   Step: 42, LR: 8.227228207639569e-07, Loss: 0.415480375289917
  0%|▏                                                                                                  | 43/34040 [02:50<36:12:50,  3.83s/it]02/06/2024 10:20:59 - INFO - __main__ -   Step: 43, LR: 8.42311459353575e-07, Loss: 0.485073983669281
  0%|▏                                                                                                  | 44/34040 [02:54<36:40:49,  3.88s/it]02/06/2024 10:21:03 - INFO - __main__ -   Step: 44, LR: 8.61900097943193e-07, Loss: 0.3432067036628723
  0%|▏                                                                                                  | 45/34040 [02:58<36:29:35,  3.86s/it]02/06/2024 10:21:07 - INFO - __main__ -   Step: 45, LR: 8.814887365328111e-07, Loss: 0.3807934522628784
  0%|▏                                                                                                  | 46/34040 [03:02<36:20:48,  3.85s/it]02/06/2024 10:21:10 - INFO - __main__ -   Step: 46, LR: 9.01077375122429e-07, Loss: 0.4067215919494629
  0%|▏                                                                                                  | 47/34040 [03:06<36:15:46,  3.84s/it]02/06/2024 10:21:14 - INFO - __main__ -   Step: 47, LR: 9.206660137120471e-07, Loss: 0.3345952033996582
  0%|▏                                                                                                  | 48/34040 [03:10<36:13:07,  3.84s/it]02/06/2024 10:21:18 - INFO - __main__ -   Step: 48, LR: 9.40254652301665e-07, Loss: 0.3081948757171631
  0%|▏                                                                                                  | 49/34040 [03:14<36:09:44,  3.83s/it]02/06/2024 10:21:22 - INFO - __main__ -   Step: 49, LR: 9.598432908912832e-07, Loss: 0.36776232719421387
  0%|▏                                                                                                  | 50/34040 [03:17<36:06:25,  3.82s/it]02/06/2024 10:21:26 - INFO - __main__ -   Step: 50, LR: 9.79431929480901e-07, Loss: 0.20132295787334442
  0%|▏                                                                                                  | 51/34040 [03:21<36:06:43,  3.82s/it]02/06/2024 10:21:30 - INFO - __main__ -   Step: 51, LR: 9.990205680705193e-07, Loss: 0.2962390184402466
  0%|▏                                                                                                  | 52/34040 [03:25<36:05:48,  3.82s/it]02/06/2024 10:21:33 - INFO - __main__ -   Step: 52, LR: 1.0186092066601373e-06, Loss: 0.2681775689125061
  0%|▏                                                                                                  | 53/34040 [03:29<36:06:09,  3.82s/it]02/06/2024 10:21:37 - INFO - __main__ -   Step: 53, LR: 1.0381978452497553e-06, Loss: 0.22616098821163177
  0%|▏                                                                                                  | 54/34040 [03:33<36:05:53,  3.82s/it]02/06/2024 10:21:41 - INFO - __main__ -   Step: 54, LR: 1.0577864838393733e-06, Loss: 0.17433270812034607
  0%|▏                                                                                                  | 55/34040 [03:36<36:04:03,  3.82s/it]02/06/2024 10:21:45 - INFO - __main__ -   Step: 55, LR: 1.0773751224289913e-06, Loss: 0.21016868948936462
  0%|▏                                                                                                  | 56/34040 [03:40<36:04:15,  3.82s/it]02/06/2024 10:21:49 - INFO - __main__ -   Step: 56, LR: 1.0969637610186093e-06, Loss: 0.2550846338272095
  0%|▏                                                                                                  | 57/34040 [03:44<36:02:18,  3.82s/it]02/06/2024 10:21:52 - INFO - __main__ -   Step: 57, LR: 1.1165523996082273e-06, Loss: 0.2618436813354492
  0%|▏                                                                                                  | 58/34040 [03:48<36:05:03,  3.82s/it]02/06/2024 10:21:56 - INFO - __main__ -   Step: 58, LR: 1.1361410381978453e-06, Loss: 0.24880628287792206
  0%|▏                                                                                                  | 59/34040 [03:52<36:04:22,  3.82s/it]02/06/2024 10:22:00 - INFO - __main__ -   Step: 59, LR: 1.1557296767874633e-06, Loss: 0.24749039113521576
  0%|▏                                                                                                  | 60/34040 [03:56<36:04:26,  3.82s/it]02/06/2024 10:22:04 - INFO - __main__ -   Step: 60, LR: 1.1753183153770813e-06, Loss: 0.25744709372520447
  0%|▏                                                                                                  | 61/34040 [03:59<36:04:02,  3.82s/it]02/06/2024 10:22:08 - INFO - __main__ -   Step: 61, LR: 1.1949069539666993e-06, Loss: 0.2934279441833496
  0%|▏                                                                                                  | 62/34040 [04:03<36:10:29,  3.83s/it]02/06/2024 10:22:12 - INFO - __main__ -   Step: 62, LR: 1.2144955925563176e-06, Loss: 0.1487410068511963
  0%|▏                                                                                                  | 63/34040 [04:07<36:07:08,  3.83s/it]02/06/2024 10:22:15 - INFO - __main__ -   Step: 63, LR: 1.2340842311459354e-06, Loss: 0.15858815610408783
Traceback (most recent call last):
  File "/local1/zefan/ZeroEE/open_instruct/open_instruct/finetune_val.py", line 1007, in <module>
    main()
  File "/local1/zefan/ZeroEE/open_instruct/open_instruct/finetune_val.py", line 804, in main
    outputs = model(**batch, use_cache=False)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/runtime/engine.py", line 1769, in forward
    loss = self.module(*inputs, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1538, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/transformers/models/llama/modeling_llama.py", line 806, in forward
    outputs = self.model(
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1538, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/transformers/models/llama/modeling_llama.py", line 693, in forward
    layer_outputs = decoder_layer(
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1538, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/transformers/models/llama/modeling_llama.py", line 408, in forward
    hidden_states, self_attn_weights, present_key_value = self.self_attn(
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1538, in _call_impl
    result = forward_call(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/transformers/models/llama/modeling_llama.py", line 307, in forward
    value_states = self.v_proj(hidden_states)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    result = hook(self, args)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 382, in _pre_forward_module_hook
    self.pre_sub_module_forward_function(module)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 494, in pre_sub_module_forward_function
    param_coordinator.fetch_sub_module(sub_module, forward=True)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
    ret_val = func(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 295, in fetch_sub_module
    self.__ongoing_fetch_events.popleft().synchronize()
  File "/local1/ponienkung/miniconda3/envs/tulu/lib/python3.8/site-packages/torch/cuda/streams.py", line 219, in synchronize
    super().synchronize()
KeyboardInterrupt